#!/bin/bash 
# Get current swap usage for all running processes
# Erik Ljungstrom 27/05/2011
# Modified by Mikko Rantalainen 2012-08-09
# Pipe the output to "sort -nk3" to get sorted output
# Modified by Marc Methot 2014-09-18
# removed the need for sudo

overall=0
for dir in /proc/[0-9]*/
do
	pid=`echo $dir | cut -d / -f 3`
	name=`ps -p $pid -o comm --no-headers`
	sum=`awk '/^VmSwap/ {s+=$2} END {print s+0}' $dir/status`
	if (( $sum > 0 )); then
		echo "pid=$pid swapped $sum KB ($name)"
	fi
	let overall=$overall+$sum
done
echo "Overall swap used: $overall KB"
